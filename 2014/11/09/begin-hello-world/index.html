<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>程序员的自我修养 - 从Hello World！说起 | 月光独奏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决。

背景知识

不要让CPU打盹：分时多任务、进程、抢占式分配CPU；
磁盘：扇区、LBS（逻辑扇区号）、文件系统;
内存不够怎么办：1. 分段（解决地址空间不隔离）；2. 分页【页大小、虚拟页/物理页、页错误和MMU(虚拟地址到物理地址的转换)】（解决使用效率低）;
线程：一个进程由一个或多个线程组成；一个标准的线程由线程ID、当前">
<meta property="og:type" content="article">
<meta property="og:title" content="程序员的自我修养 - 从Hello World！说起">
<meta property="og:url" content="http://yoursite.com/2014/11/09/begin-hello-world/">
<meta property="og:site_name" content="月光独奏">
<meta property="og:description" content="计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决。

背景知识

不要让CPU打盹：分时多任务、进程、抢占式分配CPU；
磁盘：扇区、LBS（逻辑扇区号）、文件系统;
内存不够怎么办：1. 分段（解决地址空间不隔离）；2. 分页【页大小、虚拟页/物理页、页错误和MMU(虚拟地址到物理地址的转换)】（解决使用效率低）;
线程：一个进程由一个或多个线程组成；一个标准的线程由线程ID、当前">
<meta property="og:image" content="https://msolomoon.github.io/images/objdump_simplesection.png">
<meta property="og:image" content="https://msolomoon.github.io/images/objdump_details_simplesection.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员的自我修养 - 从Hello World！说起">
<meta name="twitter:description" content="计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决。

背景知识

不要让CPU打盹：分时多任务、进程、抢占式分配CPU；
磁盘：扇区、LBS（逻辑扇区号）、文件系统;
内存不够怎么办：1. 分段（解决地址空间不隔离）；2. 分页【页大小、虚拟页/物理页、页错误和MMU(虚拟地址到物理地址的转换)】（解决使用效率低）;
线程：一个进程由一个或多个线程组成；一个标准的线程由线程ID、当前">

  
    <link rel="alternative" href="/atom.xml" title="月光独奏" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://msolo-programmer.qiniudn.com/msolo_me_square.png">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">月光独奏</a></h1>
		</hgroup>

		
		<p class="header-subtitle">软件设计及开发者</p>
		

		
			<div class="onoffswitch">
			    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
			    <label class="onoffswitch-label" for="myonoffswitch">
			        <span class="onoffswitch-inner"></span>
			        <span class="onoffswitch-switch"></span>
			    </label>
			</div>
		

		<div class="switch-area">
			<section class="first-part">
				<nav class="header-menu">
					<ul>
					
						<li><a href="/">主页</a></li>
			        
						<li><a href="/archives">所有文章</a></li>
			        
						<li><a href="/categories/随笔">随笔</a></li>
			        
						<li><a href="/categories/摘录">摘录</a></li>
			        
						<li><a href="/categories/书籍">书籍</a></li>
			        
						<li><a href="/categories/Web">Web</a></li>
			        
						<li><a href="/categories/C-Cpp-Go">C/Cpp/Go</a></li>
			        
						<li><a href="/categories/java-android">Java/Android</a></li>
			        
						<li><a href="/categories/project">Project</a></li>
			        
						<li><a href="/categories/程序员日志">程序员日志</a></li>
			        
						<li><a href="/about">关于</a></li>
			        
					</ul>
				</nav>
				<nav class="header-nav">
					<div class="social">
						
							<a class="github" target="_blank" href="https://github.com/mSoloMoon" title="github">github</a>
				        
							<a class="weibo" target="_blank" href="http://t.qq.com/zhengguangyu_msolo" title="weibo">weibo</a>
				        
							<a class="email" target="_blank" href="mailto://yuezhi.msolo@outlook.com" title="email">email</a>
				        
							<a class="qq" target="_blank" href="/212499714" title="qq">qq</a>
				        
					</div>
				</nav>
			</section>
			
			
			<section class="second-part">
				<div class="widget tagcloud">
					<a href="/tags/Android/" style="font-size: 14.29px;">Android</a><a href="/tags/C/" style="font-size: 10.00px;">C++</a><a href="/tags/C-C/" style="font-size: 10.00px;">C/C++</a><a href="/tags/Go/" style="font-size: 10.00px;">Go</a><a href="/tags/IT问题录/" style="font-size: 10.00px;">IT问题录</a><a href="/tags/IT面试/" style="font-size: 15.71px;">IT面试</a><a href="/tags/Java/" style="font-size: 15.71px;">Java</a><a href="/tags/Java-Web/" style="font-size: 10.00px;">Java Web</a><a href="/tags/书籍/" style="font-size: 10.00px;">书籍</a><a href="/tags/养生/" style="font-size: 10.00px;">养生</a><a href="/tags/历史/" style="font-size: 10.00px;">历史</a><a href="/tags/哲学/" style="font-size: 10.00px;">哲学</a><a href="/tags/思考/" style="font-size: 12.86px;">思考</a><a href="/tags/持续集成/" style="font-size: 15.71px;">持续集成</a><a href="/tags/摘录/" style="font-size: 15.71px;">摘录</a><a href="/tags/生活记录/" style="font-size: 17.14px;">生活记录</a><a href="/tags/软件开发/" style="font-size: 20.00px;">软件开发</a><a href="/tags/软件框架/" style="font-size: 11.43px;">软件框架</a><a href="/tags/软件调试/" style="font-size: 10.00px;">软件调试</a><a href="/tags/金融/" style="font-size: 10.00px;">金融</a><a href="/tags/随笔/" style="font-size: 18.57px;">随笔</a><a href="/tags/项目/" style="font-size: 12.86px;">项目</a>
				</div>
			</section>
			
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://msolo-programmer.qiniudn.com/msolo_me_square.png">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">月光独奏</a></h1>
			</hgroup>
			
			<p class="header-subtitle">软件设计及开发者</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/随笔">随笔</a></li>
		        
					<li><a href="/categories/摘录">摘录</a></li>
		        
					<li><a href="/categories/书籍">书籍</a></li>
		        
					<li><a href="/categories/Web">Web</a></li>
		        
					<li><a href="/categories/C-Cpp-Go">C/Cpp/Go</a></li>
		        
					<li><a href="/categories/java-android">Java/Android</a></li>
		        
					<li><a href="/categories/project">Project</a></li>
		        
					<li><a href="/categories/程序员日志">程序员日志</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/mSoloMoon" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://t.qq.com/zhengguangyu_msolo" title="weibo">weibo</a>
			        
						<a class="email" target="_blank" href="mailto://yuezhi.msolo@outlook.com" title="email">email</a>
			        
						<a class="qq" target="_blank" href="/212499714" title="qq">qq</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <article id="post-begin-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/09/begin-hello-world/" class="article-date">
  	<time datetime="2014-11-09T06:50:50.000Z" itemprop="datePublished">11月 9 2014</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/C-Cpp-Go/">C-Cpp-Go</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IT面试/">IT面试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件开发/">软件开发</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      程序员的自我修养 - 从Hello World！说起
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决。</p>
</blockquote>
<h3 id="背景知识">背景知识</h3>
<ul>
<li>不要让CPU打盹：分时多任务、进程、抢占式分配CPU；</li>
<li>磁盘：扇区、LBS（逻辑扇区号）、文件系统;</li>
<li>内存不够怎么办：1. 分段（解决地址空间不隔离）；2. 分页【页大小、虚拟页/物理页、页错误和MMU(虚拟地址到物理地址的转换)】（解决使用效率低）;</li>
<li>线程：一个进程由一个或多个线程组成；一个标准的线程由线程ID、当前指令指针（PC）、寄存器集合和堆栈组成；状态（就绪、运行、等待）；Linux的多线程（fork、exec和clone、写时复制）；</li>
<li>线程安全：竞争与原子操作、同步与锁（二元信号量和信号量【即多元信号量】、互斥量和临界区、读写锁、条件变量）；可重入；</li>
<li>volatile：阻止编译器为了提高速度将一个变量缓存到寄存器内而不写回；</li>
<li>对象构造（pInst = new PInst()）包含三个顺序的步骤：1. 分配内存；2. 在内存的位置上调用构造函数；3. 将内存的地址赋值给pInst；【在上述三个步骤中，CPU完全有可能动态调整2和3的执行顺序！】</li>
<li>线程并发模型：1. 一对一模型；2. 多对一模型（将多个用户线程映射到一个内核线程上）；3. 多对多模型； </li>
</ul>
<h3 id="Hello_World_程序构建">Hello World 程序构建</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="keyword">int</span> main() </div><div class="line">{</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"Hello World!"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>初级：</strong></p>
<ol>
<li>预处理: $ gcc -E hello.c -o hello.i 或 $ cpp hello.c &gt; hello.i</li>
<li>编译: $ gcc -S hello.i -o hello.s（现在版本的 GCC 把预处理和编译两个步骤合并成一个步骤，使用一个cc1的程序。）</li>
<li>汇编：$ as hello.s -o hello.o 或 $ gcc -c hello.s -o hello.o（根据汇编指令和机器指令的对照表一一翻译即可。）</li>
<li>链接：$ ld -static /usr/lib/crt1.o /usr/lib/crti.o /usr/lib/gcc/i486-linux-gnu/4.1.3/crtbeginT.o -L/usr/lib/gcc/1486-linux-gnu/4.1.3 -L/usr/lib -L/lib hello.o —start-group -lgcc -lgcc_eh -lc —end-group /usr/lib/gcc/i486-linux-gnu/4.1.3/crtend.o /usr/lib/crtn.o</li>
</ol>
<a id="more"></a>

<p><strong>中级一：编译器做了什么</strong></p>
<ul>
<li>扫描：有限状态机（分割成一系列记号，如关键字，字面量、特殊符号等），涉及的程序有lex；</li>
<li>语法分析：上下文无关语法和下推自动机 -&gt; 语法树，涉及的程序有yacc；</li>
<li>语义分析：静态语义和动态语义（在运行期才能确定的语义）-&gt; 为语法树的节点标识了类型；</li>
<li>源代码优化：三地址码和P-代码；生成中间代码（其将编译器划分为前端和后端）</li>
<li>目标代码生成及优化：编译器后端包括代码生成器和目标代码优化器，这个过程十分依赖目标机器。事实上，定义其他模块的全局变量和函数在最终运行时的绝对地址都要在最终链接的时候才能确定。</li>
</ul>
<p><strong>中级二：模块拼装（静态链接）</strong></p>
<ul>
<li>地址和空间分配</li>
<li>符号决议（Symbol Resolution）</li>
<li>重定位（Relocation）：每一个要被修正的地方叫做一个重定位入口（Relocation Entry）</li>
</ul>
<p><strong>中级三：目标文件里有什么（概念，理论）</strong></p>
<blockquote>
<p><strong>知识补充（4种ELF格式，Linux下可使用file命令查看）：</strong><br>ELF，COFF格式的变种，COFF（Common File Format）的主要贡献是在目标文件里面引入了“段”的机制；</p>
<ol>
<li>可重定位文件（.o/.obj），</li>
<li>可执行文件(linux可执行文件或.exe)</li>
<li>共享目标文件（.so/.dll），分两种：一种是供链接库链接以产生新的目标文件；另一种则是与可执行文件结合，作为进程映像的一部分来运行；</li>
<li>核心转储文件</li>
</ol>
</blockquote>
<ul>
<li>一般目标文件将这些信息按不同的属性，以“节”的形式存储，有时候也叫“段”；它们唯一的区别是在ELF的链接视图和装载视图。</li>
<li><ol>
<li>文件头：描述整个文件的文件属性，包括文件是否可执行、是静态还是动态链接，程序入口地址等；还包括一个段表，用以描述文件中各个段在文件中的偏移位置及段的属性等；</li>
</ol>
</li>
<li><ol>
<li>机器指令 -&gt; 代码段（.code或.text段）；</li>
</ol>
</li>
<li><ol>
<li>全局变量和局部静态变量数据 -&gt; 数据段（.data段）</li>
</ol>
</li>
<li><ol>
<li>未初始化的全局变量和局部静态变量 -&gt; .bss段（预留位置，不占文件空间）</li>
</ol>
</li>
<li>指令和数据分段的好处：有利于保护（指令段只读）、提高缓存命中率、共享；</li>
</ul>
<p><strong>中级三：目标文件里有什么（示例, PC_x64）</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="built_in">printf</span>( <span class="keyword">const</span> <span class="keyword">char</span>* format, ... );</div><div class="line"><span class="keyword">int</span> global_init_var = <span class="number">84</span>;</div><div class="line"><span class="keyword">int</span> global_uninit_var;</div><div class="line"><span class="keyword">void</span> func1( <span class="keyword">int</span> i ) {</div><div class="line">	<span class="built_in">printf</span>( <span class="string">"%d\n"</span>, i );</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main(<span class="keyword">void</span>)</div><div class="line">{</div><div class="line">	<span class="keyword">static</span> <span class="keyword">int</span> static_var = <span class="number">85</span>;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">int</span> static_var2;</div><div class="line">	<span class="keyword">int</span> a = <span class="number">1</span>;</div><div class="line">	<span class="keyword">int</span> b;</div><div class="line">	func1( static_var + static_var2 + a + b );</div><div class="line">	<span class="keyword">return</span> a;</div><div class="line">}</div><div class="line"><span class="comment">// $ gcc -c SimpleSection.c</span></div><div class="line"><span class="comment">// $ objdump -h SimpleSection.o 结合 $ readelf -a SimpleSection.o</span></div><div class="line"><span class="comment">// $ objdump -s -d SimpleSection.o	# -s以十六进制打印所有段的内容，-d将所有包含指令的段反汇编</span></div></pre></td></tr></table></figure>

<p><img src="https://msolomoon.github.io/images/objdump_simplesection.png" alt="各个段的header信息"><br><img src="https://msolomoon.github.io/images/objdump_details_simplesection.png" alt="各个段详细信息及部分汇编"></p>
<ul>
<li>将二进制文件，如图片，MP3等作为目标文件中的一个段的办法：</li>
<li>$ objcopy -I binary -O elf32-i386 -B i386 image.jpg image.o </li>
<li>$ objdump -ht image.o</li>
<li>程序员自定义段不能使用“.”作为前缀，示例（hackr?）： <strong>attribute</strong>((section(“FOO”))) int global = 42;</li>
</ul>
<p><strong>中级三：目标文件里有什么（补充材料）</strong></p>
<ul>
<li>ELF文件头信息：$ readelf -h SimpleSection.o    </li>
<li>ELF文件头结构及相关常数被定义在 “/usr/include/elf.h”</li>
<li>ELF文件段表：$ readelf -S SimpleSection.o</li>
<li>重定位表：对于每一个需要重定位的代码段或数据段，都会有一个相应的重定位表。</li>
<li>字符串表</li>
</ul>
<p><br></p>
<p><strong>未完待续</strong></p>
<blockquote>
<p>以上内容摘录，总结于以下参考书籍：</p>
<ol>
<li>《程序员的自我修养——链接、装载与库》，俞甲子、石凡、潘爱民著</li>
<li></li>
<li></li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/11/12/reading-nietzsche-thus-spoke-zarathustra-2122/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          自愿的死亡/施予的道德 —— 《查拉图斯特拉如是说》
        
      </div>
    </a>
  
  
    <a href="/2014/11/09/android-interview-i/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Android 面试题纪录（一）</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="begin-hello-world" data-title="程序员的自我修养 - 从Hello World！说起" data-url="http://yoursite.com/2014/11/09/begin-hello-world/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2014 月光独奏
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>